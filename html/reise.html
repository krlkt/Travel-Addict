<!DOCTYPE html>

<html>

<head>
    <meta charset="utf-8">
    <title>Reise</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/reise.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script language="JavaScript" type="text/javascript" src="/js/jquery-3.6.0.min.js"></script>
    <script language="JavaScript" type="text/javascript" src="/js/loadJS.js"></script>
</head>

<body>
    <nav class="navbarcomp"></nav>
    <div class="reise_form">
        <h1>Hinzuf√ºgen oder Entfernen einer Reise</h1>
        <form>
            <label for="name">Name der Reise</label>
            <input type="text" id="name"  required>
            <label for="startDatum">Startdatum</label>
            <input type="date" id="startDatum"  required>
            <label for="endDatum">Enddatum</label>
            <input type="date" id="endDatum"  required>
            <label for="land">Reiseland</label>
            <input id="land" list="dList" required>
            <datalist id="dList"></datalist>
            <button type="submit" class="btn-list">
                <i class="fa fa-plus" aria-hidden="true"></i>
            </button>
        </form>
        <div class="container">
            <ul></ul>
        </div>
        <script language="JavaScript" type="text/javascript" src="/js/getCountries.js"></script>
        <script>
            const btn = document.querySelector('.btn-list');
            const list = document.querySelector('.container ul');
            let input = [];


            Object.keys(localStorage).forEach(function(key)
            {

                    const li = document.createElement('li');

                    //input Elements, ids, types
                    var inputName = document.createElement('input');
                    inputName.type = "text";
                    inputName.id = "inputName";
                    var inputStartDatum = document.createElement('input');
                    inputStartDatum.type = "date";
                    inputStartDatum.id = "inputStartDatum";
                    var inputEndDatum = document.createElement('input');
                    inputEndDatum.type = "date";
                    inputEndDatum.id = "inputEndDatum";
                    var inputLand = document.createElement('input');
                    inputLand.type = "text";
                    inputLand.id = "inputLand";
                    inputLand.setAttribute('list', 'dList');
                    //inputLand.maxLength = "2";

                    li.id = "card";
                    
                    var item = JSON.parse(localStorage.getItem(key));
                    if(key == 'Reisen' && item.length != 0)
                    {
                    //var item = JSON.parse(localStorage.getItem(key));

                    li.innerHTML = "Name: "  + "\n";
                    li.name = item[0].name;
                    list.appendChild(li);
                    
                    li.appendChild(inputName);
                    inputName.defaultValue = item[0].name;
                    li.innerHTML = li.innerHTML + "Startdatum: "  + "\n";
                    li.appendChild(inputStartDatum);
                    inputStartDatum.defaultValue = item[0].startDatum;
                    li.innerHTML = li.innerHTML + "Enddatum: "  + "\n";
                    li.appendChild(inputEndDatum);
                    inputEndDatum.defaultValue = item[0].endDatum;
                    li.innerHTML = li.innerHTML + "Land: "  + "\n";
                    li.appendChild(inputLand);
                    inputLand.defaultValue = item[0].land[0] + item[0].land[1];
                    
                    //save button
                    const save = document.createElement('button')
                    save.id = "save";
                    save.innerHTML = "Save";
                    li.appendChild(save);
                    var savedInput = [];
                    
                    const saves = document.querySelectorAll('#save');
                    for(let i = 0; i < saves.length; i++)
                    {
                        saves[i].addEventListener('click', (s) => {
                            const inputs = saves[i].parentElement.querySelectorAll('input');
                            var lastName = item[0].name;

                                var savedReise = 
                                {
                                    name: inputs[0].value,
                                    startDatum: inputs[1].value,
                                    endDatum: inputs[2].value,
                                    land: inputs[3].value[0] + inputs[3].value[1]
                                }

                                savedInput.push(savedReise);
                                //localStorage.setItem(savedReise.name, JSON.stringify(savedInput));
                                localStorage.setItem("Reisen", JSON.stringify(savedInput));
                                localStorage.removeItem(lastName);
                                lastName = savedReise.name;
                                //savedInput.pop();
                            
                        });
                    }
                    

                    //span
                    const span = document.createElement('span');
                    span.innerHTML = 'X';
                    span.contentEditable = false;
                    li.appendChild(span);
                    const remove = document.querySelectorAll('span');

                    for (let i = 0; i < remove.length; i++) {
                        remove[i].addEventListener('click', () =>
                        {
                            remove[i].parentElement.remove();
                            //localStorage.removeItem(remove[i].parentElement.name);
                            localStorage.setItem("Reisen", JSON.stringify(savedInput));
                        })
                    }
                }
            });

            btn.addEventListener('click', (e) => {

                if(document.getElementById('name').value != "" && document.getElementById('startDatum').value != ""
                && document.getElementById('endDatum').value != "" && document.getElementById('land').value != "")
                {
                    e.preventDefault();

                    let reise = 
                    {
                        name: document.getElementById('name').value,
                        startDatum: document.getElementById('startDatum').value,
                        endDatum: document.getElementById('endDatum').value,
                        land: document.getElementById('land').value[0] + document.getElementById('land').value[1]
                    }
                    input.push(reise);
                    document.forms[0].reset();
                    //localStorage.setItem(reise.name, JSON.stringify(input));
                    localStorage.setItem("Reisen", JSON.stringify(input));
                    //input.pop();

                    //li
                    const li = document.createElement('li');
                    //input Elements, ids, types
                    var inputName = document.createElement('input');
                    inputName.type = "text";
                    inputName.id = "inputName";
                    var inputStartDatum = document.createElement('input');
                    inputStartDatum.type = "date";
                    inputStartDatum.id = "inputStartDatum";
                    var inputEndDatum = document.createElement('input');
                    inputEndDatum.type = "date";
                    inputEndDatum.id = "inputEndDatum";
                    var inputLand = document.createElement('input');
                    inputLand.type = "text";
                    inputLand.id = "inputLand";
                    inputLand.setAttribute('list', 'dList');
                    //inputLand.maxLength = "2";

                    //appending children
                    li.id = "card";
                    li.innerHTML = "Name: "  + "\n";
                    li.name = reise.name;
                    list.appendChild(li);
                    
                    li.appendChild(inputName);
                    inputName.defaultValue = reise.name;
                    li.innerHTML = li.innerHTML + "Startdatum: "  + "\n";
                    li.appendChild(inputStartDatum);
                    inputStartDatum.defaultValue = reise.startDatum;
                    li.innerHTML = li.innerHTML + "Enddatum: "  + "\n";
                    li.appendChild(inputEndDatum);
                    inputEndDatum.defaultValue = reise.endDatum;
                    li.innerHTML = li.innerHTML + "Land: "  + "\n";
                    li.appendChild(inputLand);
                    inputLand.defaultValue = reise.land[0] + reise.land[1]
                    
                    //save button
                    const save = document.createElement('button')
                    save.id = "save";
                    save.innerHTML = "Save";
                    li.appendChild(save);
                    var savedInput = [];
                    //var savedReise = [];
                    
                    const saves = document.querySelectorAll('#save');
                    for(let i = 0; i < saves.length; i++)
                    {
                        saves[i].addEventListener('click', (s) => {
                            const inputs = saves[i].parentElement.querySelectorAll('input');
                            var lastName = reise.name;
                                var savedReise = 
                                {
                                    name: inputs[0].value,
                                    startDatum: inputs[1].value,
                                    endDatum: inputs[2].value,
                                    land: inputs[3].value[0] + inputs[3].value[1]
                                }

                                savedInput.push(savedReise);
                                //localStorage.setItem(savedReise.name, JSON.stringify(savedInput));
                                localStorage.setItem("Reisen", JSON.stringify(savedInput));
                                localStorage.removeItem(lastName);
                                lastName = savedReise.name;
                                //savedInput.pop();
                            
                        });
                    }

                    //span
                    const span = document.createElement('span');
                    span.innerHTML = 'X';
                    span.contentEditable = false;
                    li.appendChild(span);
                const remove = document.querySelectorAll('span');

                for (let i = 0; i < remove.length; i++) {
                    remove[i].addEventListener('click', () =>
                    {
                        remove[i].parentElement.remove();
                        //localStorage.removeItem(remove[i].parentElement.name);
                        localStorage.setItem("Reisen", JSON.stringify(savedInput));
                    })
                }
                }
            });
        </script>
    </div>

</body>

</html>